--[[
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  ESCAPE TSUNAMI FOR BRAINROTS - AUTO FARM   â•‘
    â•‘  Using Rayfield UI Library                   â•‘
    â•‘  Made by: Claude                             â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]]

print("ğŸŒŠ Loading Escape Tsunami Script...")

-- Load Rayfield UI Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")

-- Player Variables
local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local Humanoid = Character:WaitForChild("Humanoid")

-- Script Settings
local Settings = {
    AutoFarm = false,
    AutoCollect = false,
    AutoAvoid = false,
    AutoSpeed = false,
    AutoRebirth = false,
    GodMode = false,
    ESPEnabled = false,
    AntiAFK = true,
    
    -- Speed Settings
    RebirthAtSpeed = 300,
    
    -- Collection Settings
    TargetRarities = {
        Celestial = true,
        Secret = true,
        Cosmic = true,
        Legendary = true,
        Mythical = true,
        Epic = true,
        Rare = true,
        Uncommon = false,
        Common = false
    }
}

-- State Variables
local FarmLoop = nil
local ESPObjects = {}

-- Create Rayfield Window
local Window = Rayfield:CreateWindow({
    Name = "ğŸŒŠ Escape Tsunami Auto Farm",
    LoadingTitle = "Loading Auto Farm...",
    LoadingSubtitle = "by Claude",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "EscapeTsunamiConfig",
        FileName = "Config"
    },
    Discord = {
        Enabled = false,
        Invite = "",
        RememberJoins = false
    },
    KeySystem = false,
})

-- Create Tabs
local MainTab = Window:CreateTab("ğŸ¯ Main", 4483362458)
local TeleportTab = Window:CreateTab("ğŸš€ Teleport", 4483362458)
local MiscTab = Window:CreateTab("âš™ï¸ Misc", 4483362458)
local SettingsTab = Window:CreateTab("ğŸ”§ Settings", 4483362458)

-- Helper Functions

local function Notify(title, content, duration)
    Rayfield:Notify({
        Title = title,
        Content = content,
        Duration = duration or 5,
        Image = 4483362458,
    })
end

local function GetBrainrots()
    local brainrots = {}
    local brainrotFolder = Workspace:FindFirstChild("Brainrots")
    
    if brainrotFolder then
        for _, brainrot in pairs(brainrotFolder:GetChildren()) do
            if brainrot:IsA("Model") or brainrot:IsA("Part") then
                -- Check if rarity is enabled
                local rarity = brainrot:GetAttribute("Rarity") or "Common"
                if Settings.TargetRarities[rarity] then
                    table.insert(brainrots, brainrot)
                end
            end
        end
    end
    
    return brainrots
end

local function TeleportTo(position)
    if HumanoidRootPart and typeof(position) == "Vector3" then
        HumanoidRootPart.CFrame = CFrame.new(position)
    elseif HumanoidRootPart and typeof(position) == "CFrame" then
        HumanoidRootPart.CFrame = position
    end
end

local function GetSafeZone()
    -- Try to find safe zone
    local speedShop = Workspace:FindFirstChild("SpeedShop")
    if speedShop then
        return speedShop.Position
    end
    
    -- Try to find base
    local bases = Workspace:FindFirstChild("Bases")
    if bases and bases:FindFirstChild(Player.Name) then
        return bases[Player.Name].Position
    end
    
    return Vector3.new(0, 10, 0)
end

local function CheckTsunami()
    -- Check for tsunami waves nearby
    local tsunamis = Workspace:FindFirstChild("Tsunamis") or Workspace:FindFirstChild("Waves")
    if tsunamis then
        for _, wave in pairs(tsunamis:GetChildren()) do
            if wave:IsA("BasePart") or wave:FindFirstChild("Part") then
                local wavePart = wave:IsA("BasePart") and wave or wave:FindFirstChild("Part")
                if wavePart then
                    local distance = (HumanoidRootPart.Position - wavePart.Position).Magnitude
                    if distance < 150 then
                        return true, wavePart
                    end
                end
            end
        end
    end
    return false
end

local function CollectBrainrot(brainrot)
    if not brainrot or not brainrot.Parent then return false end
    
    local brainrotPart = brainrot:IsA("BasePart") and brainrot or brainrot:FindFirstChild("Part") or brainrot.PrimaryPart
    
    if brainrotPart then
        -- Teleport to brainrot
        TeleportTo(brainrotPart.Position)
        wait(0.15)
        
        -- Try to collect via touch or remote
        local success = pcall(function()
            -- Some games use proximity prompts
            local prompt = brainrot:FindFirstChildOfClass("ProximityPrompt")
            if prompt then
                fireproximityprompt(prompt)
            end
            
            -- Try remote events
            local remotes = ReplicatedStorage:GetDescendants()
            for _, remote in pairs(remotes) do
                if remote:IsA("RemoteEvent") and (remote.Name:lower():find("collect") or remote.Name:lower():find("grab")) then
                    remote:FireServer(brainrot)
                end
            end
        end)
        
        return true
    end
    
    return false
end

local function BuySpeedUpgrade(amount)
    amount = amount or 1
    
    pcall(function()
        -- Find and fire speed upgrade remotes
        local remotes = ReplicatedStorage:GetDescendants()
        for _, remote in pairs(remotes) do
            if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
                if remote.Name:lower():find("speed") or remote.Name:lower():find("upgrade") or remote.Name:lower():find("buy") then
                    if remote:IsA("RemoteEvent") then
                        for i = 1, amount do
                            remote:FireServer()
                            wait(0.05)
                        end
                    else
                        for i = 1, amount do
                            remote:InvokeServer()
                            wait(0.05)
                        end
                    end
                end
            end
        end
    end)
end

local function DoRebirth()
    pcall(function()
        local remotes = ReplicatedStorage:GetDescendants()
        for _, remote in pairs(remotes) do
            if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
                if remote.Name:lower():find("rebirth") then
                    if remote:IsA("RemoteEvent") then
                        remote:FireServer()
                    else
                        remote:InvokeServer()
                    end
                    Notify("Rebirth", "Rebirthed successfully!", 3)
                    break
                end
            end
        end
    end)
end

local function CreateBrainrotESP(brainrot)
    if not Settings.ESPEnabled or not brainrot then return end
    
    local brainrotPart = brainrot:IsA("BasePart") and brainrot or brainrot:FindFirstChild("Part") or brainrot.PrimaryPart
    if not brainrotPart then return end
    
    -- Remove existing ESP
    if brainrotPart:FindFirstChild("BrainrotESP") then
        brainrotPart.BrainrotESP:Destroy()
    end
    
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "BrainrotESP"
    billboard.Adornee = brainrotPart
    billboard.Size = UDim2.new(0, 100, 0, 50)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = brainrotPart
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundColor3 = Color3.fromRGB(255, 0, 255)
    frame.BackgroundTransparency = 0.5
    frame.Parent = billboard
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = frame
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = "ğŸ’ " .. (brainrot.Name or "Brainrot")
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextStrokeTransparency = 0
    label.TextScaled = true
    label.Font = Enum.Font.GothamBold
    label.Parent = frame
    
    table.insert(ESPObjects, billboard)
end

local function ClearESP()
    for _, esp in pairs(ESPObjects) do
        if esp and esp.Parent then
            esp:Destroy()
        end
    end
    ESPObjects = {}
end

-- Main Auto Farm Loop
local function StartAutoFarm()
    if FarmLoop then return end
    
    FarmLoop = RunService.Heartbeat:Connect(function()
        if not Settings.AutoFarm then return end
        
        pcall(function()
            -- Update character reference
            Character = Player.Character
            if not Character then return end
            HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
            Humanoid = Character:FindFirstChild("Humanoid")
            if not HumanoidRootPart or not Humanoid then return end
            
            -- God Mode
            if Settings.GodMode and Humanoid then
                Humanoid.Health = Humanoid.MaxHealth
            end
            
            -- Check for tsunami and avoid
            if Settings.AutoAvoid then
                local tsunamiNear = CheckTsunami()
                if tsunamiNear then
                    local safeZone = GetSafeZone()
                    TeleportTo(safeZone)
                    wait(3)
                    return
                end
            end
            
            -- Auto speed upgrade
            if Settings.AutoSpeed then
                BuySpeedUpgrade(1)
                wait(0.5)
            end
            
            -- Auto rebirth
            if Settings.AutoRebirth and Humanoid.WalkSpeed >= Settings.RebirthAtSpeed then
                DoRebirth()
                wait(5)
            end
            
            -- Auto collect brainrots
            if Settings.AutoCollect then
                local brainrots = GetBrainrots()
                
                for _, brainrot in pairs(brainrots) do
                    if not Settings.AutoFarm then break end
                    
                    -- Create ESP
                    CreateBrainrotESP(brainrot)
                    
                    -- Check tsunami before collecting
                    if Settings.AutoAvoid and CheckTsunami() then
                        break
                    end
                    
                    -- Collect brainrot
                    CollectBrainrot(brainrot)
                    wait(0.2)
                    
                    -- Return to safe zone after collecting
                    local safeZone = GetSafeZone()
                    TeleportTo(safeZone)
                    wait(0.3)
                end
            end
        end)
        
        wait(0.5)
    end)
    
    Notify("Auto Farm", "Started!", 3)
end

local function StopAutoFarm()
    if FarmLoop then
        FarmLoop:Disconnect()
        FarmLoop = nil
    end
    ClearESP()
    Notify("Auto Farm", "Stopped!", 3)
end

-- MAIN TAB
MainTab:CreateLabel("â”â”â” ğŸ® Main Features â”â”â”")

local AutoFarmToggle = MainTab:CreateToggle({
    Name = "ğŸŒŠ Auto Farm",
    CurrentValue = false,
    Flag = "AutoFarm",
    Callback = function(Value)
        Settings.AutoFarm = Value
        if Value then
            StartAutoFarm()
        else
            StopAutoFarm()
        end
    end,
})

local AutoCollectToggle = MainTab:CreateToggle({
    Name = "ğŸ’ Auto Collect Brainrots",
    CurrentValue = false,
    Flag = "AutoCollect",
    Callback = function(Value)
        Settings.AutoCollect = Value
    end,
})

local AutoAvoidToggle = MainTab:CreateToggle({
    Name = "âš ï¸ Auto Avoid Tsunami",
    CurrentValue = false,
    Flag = "AutoAvoid",
    Callback = function(Value)
        Settings.AutoAvoid = Value
    end,
})

local AutoSpeedToggle = MainTab:CreateToggle({
    Name = "âš¡ Auto Upgrade Speed",
    CurrentValue = false,
    Flag = "AutoSpeed",
    Callback = function(Value)
        Settings.AutoSpeed = Value
    end,
})

local AutoRebirthToggle = MainTab:CreateToggle({
    Name = "ğŸ”„ Auto Rebirth",
    CurrentValue = false,
    Flag = "AutoRebirth",
    Callback = function(Value)
        Settings.AutoRebirth = Value
    end,
})

MainTab:CreateLabel("â”â”â” âš¡ Manual Actions â”â”â”")

MainTab:CreateButton({
    Name = "âš¡ Buy Speed +1",
    Callback = function()
        BuySpeedUpgrade(1)
        Notify("Speed Upgrade", "Bought +1 speed!", 2)
    end,
})

MainTab:CreateButton({
    Name = "âš¡âš¡ Buy Speed +10",
    Callback = function()
        BuySpeedUpgrade(10)
        Notify("Speed Upgrade", "Bought +10 speed!", 2)
    end,
})

MainTab:CreateButton({
    Name = "ğŸ”„ Rebirth Now",
    Callback = function()
        DoRebirth()
    end,
})

-- TELEPORT TAB
TeleportTab:CreateLabel("â”â”â” ğŸš€ Teleports â”â”â”")

TeleportTab:CreateButton({
    Name = "ğŸ  Teleport to Safe Zone",
    Callback = function()
        local safeZone = GetSafeZone()
        TeleportTo(safeZone)
        Notify("Teleport", "Teleported to safe zone!", 2)
    end,
})

TeleportTab:CreateButton({
    Name = "ğŸ’ Teleport to Nearest Brainrot",
    Callback = function()
        local brainrots = GetBrainrots()
        if #brainrots > 0 then
            local nearest = brainrots[1]
            local nearestDist = math.huge
            
            for _, brainrot in pairs(brainrots) do
                local part = brainrot:IsA("BasePart") and brainrot or brainrot:FindFirstChild("Part")
                if part then
                    local dist = (HumanoidRootPart.Position - part.Position).Magnitude
                    if dist < nearestDist then
                        nearestDist = dist
                        nearest = brainrot
                    end
                end
            end
            
            local part = nearest:IsA("BasePart") and nearest or nearest:FindFirstChild("Part")
            if part then
                TeleportTo(part.Position)
                Notify("Teleport", "Teleported to brainrot!", 2)
            end
        else
            Notify("Error", "No brainrots found!", 3)
        end
    end,
})

-- MISC TAB
MiscTab:CreateLabel("â”â”â” ğŸ›¡ï¸ Protection â”â”â”")

MiscTab:CreateToggle({
    Name = "ğŸ›¡ï¸ God Mode",
    CurrentValue = false,
    Flag = "GodMode",
    Callback = function(Value)
        Settings.GodMode = Value
    end,
})

MiscTab:CreateToggle({
    Name = "ğŸ’¤ Anti-AFK",
    CurrentValue = true,
    Flag = "AntiAFK",
    Callback = function(Value)
        Settings.AntiAFK = Value
    end,
})

MiscTab:CreateLabel("â”â”â” ğŸ‘ï¸ Visual â”â”â”")

MiscTab:CreateToggle({
    Name = "ğŸ‘ï¸ ESP (Highlight Brainrots)",
    CurrentValue = false,
    Flag = "ESP",
    Callback = function(Value)
        Settings.ESPEnabled = Value
        if not Value then
            ClearESP()
        end
    end,
})

MiscTab:CreateButton({
    Name = "ğŸ§¹ Clear ESP",
    Callback = function()
        ClearESP()
        Notify("ESP", "Cleared all ESP!", 2)
    end,
})

MiscTab:CreateLabel("â”â”â” ğŸ® Game Actions â”â”â”")

MiscTab:CreateButton({
    Name = "ğŸ”„ Reset Character",
    Callback = function()
        if Humanoid then
            Humanoid.Health = 0
        end
    end,
})

-- SETTINGS TAB
SettingsTab:CreateLabel("â”â”â” ğŸ”§ Rarity Settings â”â”â”")

SettingsTab:CreateToggle({
    Name = "ğŸŒŸ Celestial",
    CurrentValue = Settings.TargetRarities.Celestial,
    Flag = "Celestial",
    Callback = function(Value)
        Settings.TargetRarities.Celestial = Value
    end,
})

SettingsTab:CreateToggle({
    Name = "ğŸ”® Secret",
    CurrentValue = Settings.TargetRarities.Secret,
    Flag = "Secret",
    Callback = function(Value)
        Settings.TargetRarities.Secret = Value
    end,
})

SettingsTab:CreateToggle({
    Name = "ğŸŒŒ Cosmic",
    CurrentValue = Settings.TargetRarities.Cosmic,
    Flag = "Cosmic",
    Callback = function(Value)
        Settings.TargetRarities.Cosmic = Value
    end,
})

SettingsTab:CreateToggle({
    Name = "ğŸ‘‘ Legendary",
    CurrentValue = Settings.TargetRarities.Legendary,
    Flag = "Legendary",
    Callback = function(Value)
        Settings.TargetRarities.Legendary = Value
    end,
})

SettingsTab:CreateToggle({
    Name = "âœ¨ Mythical",
    CurrentValue = Settings.TargetRarities.Mythical,
    Flag = "Mythical",
    Callback = function(Value)
        Settings.TargetRarities.Mythical = Value
    end,
})

SettingsTab:CreateToggle({
    Name = "ğŸ’œ Epic",
    CurrentValue = Settings.TargetRarities.Epic,
    Flag = "Epic",
    Callback = function(Value)
        Settings.TargetRarities.Epic = Value
    end,
})

SettingsTab:CreateToggle({
    Name = "ğŸ’™ Rare",
    CurrentValue = Settings.TargetRarities.Rare,
    Flag = "Rare",
    Callback = function(Value)
        Settings.TargetRarities.Rare = Value
    end,
})

SettingsTab:CreateToggle({
    Name = "ğŸ’š Uncommon",
    CurrentValue = Settings.TargetRarities.Uncommon,
    Flag = "Uncommon",
    Callback = function(Value)
        Settings.TargetRarities.Uncommon = Value
    end,
})

SettingsTab:CreateToggle({
    Name = "âšª Common",
    CurrentValue = Settings.TargetRarities.Common,
    Flag = "Common",
    Callback = function(Value)
        Settings.TargetRarities.Common = Value
    end,
})

SettingsTab:CreateLabel("â”â”â” âš™ï¸ Advanced Settings â”â”â”")

SettingsTab:CreateSlider({
    Name = "Rebirth Speed Threshold",
    Range = {100, 500},
    Increment = 10,
    CurrentValue = 300,
    Flag = "RebirthSpeed",
    Callback = function(Value)
        Settings.RebirthAtSpeed = Value
    end,
})

-- Anti-AFK
Player.Idled:Connect(function()
    if Settings.AntiAFK then
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end
end)

-- Character respawn handler
Player.CharacterAdded:Connect(function(char)
    Character = char
    Humanoid = Character:WaitForChild("Humanoid")
    HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
    wait(2)
end)

-- Load Configuration
Rayfield:LoadConfiguration()

-- Success notification
Notify("Script Loaded!", "Escape Tsunami Auto Farm is ready! ğŸŒŠ", 5)

print("âœ… Script Loaded Successfully!")
print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
print("ğŸŒŠ ESCAPE TSUNAMI FOR BRAINROTS")
print("âœ¨ Auto Farm Menu Loaded!")
print("ğŸ® Toggle features in the GUI!")
print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
