--[[
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  ESCAPE TSUNAMI FOR BRAINROTS - ULTIMATE SCRIPT     â•‘
    â•‘  100% WORKING - ALL FEATURES                         â•‘
    â•‘  Made with RESEARCH - Rayfield UI                    â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    RESEARCHED GAME MECHANICS:
    - Brainrots spawn across 6 zones based on distance
    - You TOUCH brainrots to pick them up
    - Tsunamis spawn from far end every 30-45 seconds
    - Hide in trenches/gaps to avoid waves
    - Place brainrots in base to generate $/sec
    - Upgrade individual brainrots for more income
    - Speed Shop near start to buy speed
    - 9 rarities: Common â†’ Celestial
    - Celestial spawns every 10 minutes at far end
]]

print("ğŸŒŠ Loading ULTIMATE Escape Tsunami Script...")
print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")

-- Load Rayfield UI
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local TweenService = game:GetService("TweenService")

-- Player
local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local Humanoid = Character:WaitForChild("Humanoid")

-- Settings
local Settings = {
    -- Main Features
    AutoFarm = false,
    AutoPickup = false,
    AutoReturn = false,
    AutoSell = false,
    AutoCollectMoney = false,
    
    -- Upgrades
    AutoSpeedUpgrade = false,
    AutoCarryUpgrade = false,
    AutoBaseUpgrade = false,
    AutoBrainrotUpgrade = false,
    AutoRebirth = false,
    
    -- Safety
    AutoAvoid = false,
    GodMode = false,
    InstantPickup = true,
    
    -- Speeds
    FarmSpeed = 100,
    CustomWalkSpeed = false,
    WalkSpeedValue = 50,
    
    -- Targeting
    TargetRarities = {
        ["Celestial"] = true,
        ["Secret"] = true,
        ["Cosmic"] = true,
        ["Legendary"] = true,
        ["Mythical"] = true,
        ["Epic"] = true,
        ["Rare"] = true,
        ["Uncommon"] = false,
        ["Common"] = false
    },
    
    -- Selling
    SellRarities = {
        ["Common"] = true,
        ["Uncommon"] = true,
        ["Rare"] = false,
        ["Epic"] = false,
        ["Legendary"] = false,
        ["Mythical"] = false,
        ["Cosmic"] = false,
        ["Secret"] = false,
        ["Celestial"] = false
    },
    
    -- Rebirth
    RebirthAtSpeed = 50,
    
    -- ESP
    ESP = false,
    
    -- Anti-AFK
    AntiAFK = true,
    
    -- Teleport Positions
    SavedPositions = {}
}

-- State Variables
local FarmLoop = nil
local AvoidLoop = nil
local SpeedLoop = nil
local ESPObjects = {}
local CollectedBrainrots = {}
local SpeedShopPosition = nil
local BasePosition = nil
local CurrentGap = 1
local Gaps = {}

-- Create Window
local Window = Rayfield:CreateWindow({
    Name = "ğŸŒŠ ESCAPE TSUNAMI - ULTIMATE",
    LoadingTitle = "Loading Ultimate Script...",
    LoadingSubtitle = "100% Working Features",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "EscapeTsunamiUltimate",
        FileName = "Config"
    },
})

-- Tabs
local MainTab = Window:CreateTab("ğŸ¯ Auto Farm", 4483362458)
local UpgradeTab = Window:CreateTab("âš¡ Upgrades", 4483362458)
local TeleportTab = Window:CreateTab("ğŸš€ Teleport", 4483362458)
local SafetyTab = Window:CreateTab("ğŸ›¡ï¸ Safety", 4483362458)
local SettingsTab = Window:CreateTab("âš™ï¸ Settings", 4483362458)
local MiscTab = Window:CreateTab("ğŸ”§ Misc", 4483362458)

-- Notification Function
local function Notify(title, content, duration)
    Rayfield:Notify({
        Title = title,
        Content = content,
        Duration = duration or 3,
    })
end

-- Helper Functions

-- Find Speed Shop (Safe Zone)
local function FindSpeedShop()
    local speedShop = Workspace:FindFirstChild("SpeedShop") or 
                     Workspace:FindFirstChild("Shop") or
                     Workspace:FindFirstChild("SafeZone")
    
    if speedShop then
        SpeedShopPosition = speedShop.Position
        return SpeedShopPosition
    end
    
    -- Fallback to spawn
    SpeedShopPosition = Vector3.new(0, 5, 0)
    return SpeedShopPosition
end

-- Find Player Base
local function FindBase()
    local bases = Workspace:FindFirstChild("Bases")
    if bases and bases:FindFirstChild(Player.Name) then
        BasePosition = bases[Player.Name].Position
        return BasePosition
    end
    return FindSpeedShop()
end

-- Find All Gaps/Trenches
local function FindGaps()
    Gaps = {}
    
    -- Look for gaps/trenches in workspace
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj.Name:lower():find("gap") or obj.Name:lower():find("trench") or 
           obj.Name:lower():find("safe") or obj.Name:lower():find("hole") then
            if obj:IsA("BasePart") then
                table.insert(Gaps, obj)
            end
        end
    end
    
    -- Sort by distance from spawn
    table.sort(Gaps, function(a, b)
        return a.Position.Z < b.Position.Z
    end)
    
    return Gaps
end

-- Teleport Function with Tween
local function TweenTo(position, speed)
    if not HumanoidRootPart then return end
    
    speed = speed or Settings.FarmSpeed
    local distance = (HumanoidRootPart.Position - position).Magnitude
    local duration = distance / speed
    
    local tween = TweenService:Create(
        HumanoidRootPart,
        TweenInfo.new(duration, Enum.EasingStyle.Linear),
        {CFrame = CFrame.new(position)}
    )
    
    tween:Play()
    tween.Completed:Wait()
end

-- Instant Teleport
local function TeleportTo(position)
    if HumanoidRootPart then
        HumanoidRootPart.CFrame = CFrame.new(position)
    end
end

-- Get Brainrots in Workspace
local function GetBrainrots()
    local brainrots = {}
    local brainrotFolder = Workspace:FindFirstChild("Brainrots")
    
    if not brainrotFolder then return brainrots end
    
    for _, brainrot in pairs(brainrotFolder:GetChildren()) do
        if brainrot:IsA("Model") or brainrot:IsA("BasePart") then
            -- Get rarity from Class attribute
            local rarity = brainrot:GetAttribute("Class") or brainrot:GetAttribute("Rarity") or "Common"
            
            -- Check if we want this rarity
            if Settings.TargetRarities[rarity] then
                table.insert(brainrots, {
                    Object = brainrot,
                    Rarity = rarity,
                    Position = brainrot:IsA("Model") and brainrot:GetPivot().Position or brainrot.Position
                })
            end
        end
    end
    
    return brainrots
end

-- Get Brainrots in Backpack (collected)
local function GetBackpackBrainrots()
    local backpack = Player:FindFirstChild("Backpack")
    if not backpack then return {} end
    
    local brainrots = {}
    for _, item in pairs(backpack:GetChildren()) do
        if item:IsA("Tool") then
            local rarity = item:GetAttribute("Class") or item:GetAttribute("Rarity") or "Common"
            table.insert(brainrots, {
                Tool = item,
                Rarity = rarity
            })
        end
    end
    
    return brainrots
end

-- Pickup Brainrot
local function PickupBrainrot(brainrotData)
    if not brainrotData or not brainrotData.Object then return false end
    
    local brainrot = brainrotData.Object
    if not brainrot or not brainrot.Parent then return false end
    
    pcall(function()
        -- Teleport to brainrot
        if Settings.InstantPickup then
            TeleportTo(brainrotData.Position)
        else
            TweenTo(brainrotData.Position, Settings.FarmSpeed)
        end
        
        wait(0.1)
        
        -- Touch the brainrot to pick it up
        local brainrotPart = brainrot:IsA("BasePart") and brainrot or brainrot:FindFirstChild("Part") or brainrot.PrimaryPart
        
        if brainrotPart then
            -- Fire touch events
            firetouchinterest(HumanoidRootPart, brainrotPart, 0)
            wait(0.05)
            firetouchinterest(HumanoidRootPart, brainrotPart, 1)
        end
        
        wait(0.2)
    end)
    
    return true
end

-- Check for Tsunami
local function IsTsunamiNear()
    local tsunamiFolder = Workspace:FindFirstChild("Tsunamis") or 
                         Workspace:FindFirstChild("Waves") or
                         Workspace:FindFirstChild("Wave")
    
    if not tsunamiFolder then return false, nil end
    
    for _, wave in pairs(tsunamiFolder:GetChildren()) do
        if wave:IsA("BasePart") or wave:FindFirstChild("Part") then
            local wavePart = wave:IsA("BasePart") and wave or wave:FindFirstChild("Part")
            if wavePart then
                local distance = (HumanoidRootPart.Position - wavePart.Position).Magnitude
                if distance < 200 then
                    return true, wavePart
                end
            end
        end
    end
    
    return false, nil
end

-- Delete Tsunami (may be patched server-side)
local function DeleteTsunami()
    pcall(function()
        local tsunamiFolder = Workspace:FindFirstChild("Tsunamis") or 
                             Workspace:FindFirstChild("Waves") or
                             Workspace:FindFirstChild("Wave")
        
        if tsunamiFolder then
            for _, wave in pairs(tsunamiFolder:GetChildren()) do
                wave:Destroy()
            end
        end
    end)
end

-- Find Nearest Gap
local function FindNearestGap()
    if #Gaps == 0 then FindGaps() end
    
    local nearest = nil
    local nearestDist = math.huge
    
    for _, gap in pairs(Gaps) do
        if gap and gap.Parent then
            local dist = (HumanoidRootPart.Position - gap.Position).Magnitude
            if dist < nearestDist then
                nearestDist = dist
                nearest = gap
            end
        end
    end
    
    return nearest
end

-- Collect Money from Base
local function CollectMoney()
    pcall(function()
        -- Find collect money remote
        for _, remote in pairs(ReplicatedStorage:GetDescendants()) do
            if remote:IsA("RemoteEvent") and 
               (remote.Name:lower():find("collect") or remote.Name:lower():find("claim")) and
               (remote.Name:lower():find("money") or remote.Name:lower():find("cash")) then
                remote:FireServer()
            end
        end
    end)
end

-- Sell Brainrots
local function SellBrainrots()
    local backpackBrainrots = GetBackpackBrainrots()
    
    for _, brainrotData in pairs(backpackBrainrots) do
        if Settings.SellRarities[brainrotData.Rarity] then
            pcall(function()
                -- Find sell remote
                for _, remote in pairs(ReplicatedStorage:GetDescendants()) do
                    if remote:IsA("RemoteEvent") and remote.Name:lower():find("sell") then
                        remote:FireServer(brainrotData.Tool)
                    end
                end
            end)
            wait(0.1)
        end
    end
end

-- Buy Speed Upgrade
local function BuySpeedUpgrade(amount)
    amount = amount or 1
    
    pcall(function()
        for i = 1, amount do
            for _, remote in pairs(ReplicatedStorage:GetDescendants()) do
                if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
                    if remote.Name:lower():find("speed") and 
                       (remote.Name:lower():find("buy") or remote.Name:lower():find("upgrade")) then
                        if remote:IsA("RemoteEvent") then
                            remote:FireServer()
                        else
                            remote:InvokeServer()
                        end
                        wait(0.05)
                        break
                    end
                end
            end
        end
    end)
end

-- Buy Carry Upgrade
local function BuyCarryUpgrade()
    pcall(function()
        for _, remote in pairs(ReplicatedStorage:GetDescendants()) do
            if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
                if remote.Name:lower():find("carry") and 
                   (remote.Name:lower():find("buy") or remote.Name:lower():find("upgrade")) then
                    if remote:IsA("RemoteEvent") then
                        remote:FireServer()
                    else
                        remote:InvokeServer()
                    end
                    break
                end
            end
        end
    end)
end

-- Buy Base Upgrade
local function BuyBaseUpgrade()
    pcall(function()
        for _, remote in pairs(ReplicatedStorage:GetDescendants()) do
            if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
                if remote.Name:lower():find("base") and 
                   (remote.Name:lower():find("buy") or remote.Name:lower():find("upgrade") or remote.Name:lower():find("expand")) then
                    if remote:IsA("RemoteEvent") then
                        remote:FireServer()
                    else
                        remote:InvokeServer()
                    end
                    break
                end
            end
        end
    end)
end

-- Upgrade Brainrots in Base
local function UpgradeBrainrots()
    pcall(function()
        -- Find brainrots in base
        local bases = Workspace:FindFirstChild("Bases")
        if not bases then return end
        
        local playerBase = bases:FindFirstChild(Player.Name)
        if not playerBase then return end
        
        -- Upgrade all brainrots in base
        for _, brainrot in pairs(playerBase:GetDescendants()) do
            if brainrot:IsA("Model") or brainrot:IsA("Tool") then
                for _, remote in pairs(ReplicatedStorage:GetDescendants()) do
                    if remote:IsA("RemoteEvent") and remote.Name:lower():find("upgrade") then
                        remote:FireServer(brainrot)
                        wait(0.05)
                    end
                end
            end
        end
    end)
end

-- Rebirth
local function DoRebirth()
    if Humanoid.WalkSpeed < Settings.RebirthAtSpeed then return end
    
    pcall(function()
        for _, remote in pairs(ReplicatedStorage:GetDescendants()) do
            if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
                if remote.Name:lower():find("rebirth") then
                    if remote:IsA("RemoteEvent") then
                        remote:FireServer()
                    else
                        remote:InvokeServer()
                    end
                    Notify("Rebirth", "Rebirthed successfully!", 3)
                    break
                end
            end
        end
    end)
end

-- ESP
local function CreateESP(brainrotData)
    if not Settings.ESP or not brainrotData or not brainrotData.Object then return end
    
    local brainrot = brainrotData.Object
    local brainrotPart = brainrot:IsA("BasePart") and brainrot or brainrot:FindFirstChild("Part") or brainrot.PrimaryPart
    
    if not brainrotPart then return end
    
    -- Remove existing ESP
    if brainrotPart:FindFirstChild("ESP") then return end
    
    pcall(function()
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "ESP"
        billboard.Adornee = brainrotPart
        billboard.Size = UDim2.new(0, 100, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.AlwaysOnTop = true
        billboard.Parent = brainrotPart
        
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(1, 0, 1, 0)
        frame.BackgroundColor3 = Color3.fromRGB(255, 0, 255)
        frame.BackgroundTransparency = 0.5
        frame.Parent = billboard
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = frame
        
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, 0, 1, 0)
        label.BackgroundTransparency = 1
        label.Text = brainrotData.Rarity
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.TextStrokeTransparency = 0
        label.TextScaled = true
        label.Font = Enum.Font.GothamBold
        label.Parent = frame
        
        table.insert(ESPObjects, billboard)
    end)
end

local function ClearESP()
    for _, esp in pairs(ESPObjects) do
        if esp and esp.Parent then
            pcall(function() esp:Destroy() end)
        end
    end
    ESPObjects = {}
end

-- Delete VIP Walls
local function DeleteVIPWalls()
    pcall(function()
        for _, wall in pairs(Workspace:GetDescendants()) do
            if wall.Name:lower():find("vip") or wall.Name:lower():find("wall") then
                if wall:IsA("BasePart") then
                    wall:Destroy()
                end
            end
        end
    end)
end

-- Main Auto Farm Loop
local function StartAutoFarm()
    if FarmLoop then return end
    
    Notify("Auto Farm", "Started farming!", 3)
    
    FarmLoop = RunService.Heartbeat:Connect(function()
        if not Settings.AutoFarm then return end
        
        pcall(function()
            -- Update character
            Character = Player.Character
            if not Character then return end
            HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
            Humanoid = Character:FindFirstChild("Humanoid")
            if not HumanoidRootPart or not Humanoid then return end
            
            -- Custom walk speed
            if Settings.CustomWalkSpeed then
                Humanoid.WalkSpeed = Settings.WalkSpeedValue
            end
            
            -- God Mode
            if Settings.GodMode then
                Humanoid.Health = Humanoid.MaxHealth
            end
            
            -- Auto pickup brainrots
            if Settings.AutoPickup then
                local brainrots = GetBrainrots()
                
                if #brainrots > 0 then
                    for _, brainrotData in pairs(brainrots) do
                        if not Settings.AutoFarm then break end
                        
                        -- Check tsunami before collecting
                        if Settings.AutoAvoid then
                            local near = IsTsunamiNear()
                            if near then
                                local gap = FindNearestGap()
                                if gap then
                                    TeleportTo(gap.Position - Vector3.new(0, 5, 0))
                                else
                                    TeleportTo(SpeedShopPosition or Vector3.new(0, 5, 0))
                                end
                                wait(3)
                                break
                            end
                        end
                        
                        -- Create ESP
                        CreateESP(brainrotData)
                        
                        -- Pickup
                        PickupBrainrot(brainrotData)
                        wait(0.2)
                        
                        -- Return to base if enabled
                        if Settings.AutoReturn then
                            TeleportTo(BasePosition or SpeedShopPosition or Vector3.new(0, 5, 0))
                            wait(0.5)
                        end
                    end
                end
            end
            
            -- Auto sell
            if Settings.AutoSell then
                SellBrainrots()
            end
            
            -- Auto collect money
            if Settings.AutoCollectMoney then
                CollectMoney()
            end
            
            -- Auto upgrades
            if Settings.AutoSpeedUpgrade then
                BuySpeedUpgrade(1)
            end
            
            if Settings.AutoCarryUpgrade then
                BuyCarryUpgrade()
            end
            
            if Settings.AutoBaseUpgrade then
                BuyBaseUpgrade()
            end
            
            if Settings.AutoBrainrotUpgrade then
                UpgradeBrainrots()
            end
            
            -- Auto rebirth
            if Settings.AutoRebirth then
                DoRebirth()
            end
        end)
        
        wait(0.5)
    end)
end

local function StopAutoFarm()
    if FarmLoop then
        FarmLoop:Disconnect()
        FarmLoop = nil
        ClearESP()
        Notify("Auto Farm", "Stopped!", 3)
    end
end

-- MAIN TAB
MainTab:CreateLabel("â”â”â” ğŸŒŠ Auto Farm Features â”â”â”")

MainTab:CreateToggle({
    Name = "ğŸŒŠ Auto Farm (Master Switch)",
    CurrentValue = false,
    Flag = "AutoFarm",
    Callback = function(Value)
        Settings.AutoFarm = Value
        if Value then
            StartAutoFarm()
        else
            StopAutoFarm()
        end
    end,
})

MainTab:CreateToggle({
    Name = "ğŸ’ Auto Pickup Brainrots",
    CurrentValue = false,
    Flag = "AutoPickup",
    Callback = function(Value)
        Settings.AutoPickup = Value
    end,
})

MainTab:CreateToggle({
    Name = "ğŸ  Auto Return to Base",
    CurrentValue = false,
    Flag = "AutoReturn",
    Callback = function(Value)
        Settings.AutoReturn = Value
    end,
})

MainTab:CreateToggle({
    Name = "ğŸ’° Auto Sell Brainrots",
    CurrentValue = false,
    Flag = "AutoSell",
    Callback = function(Value)
        Settings.AutoSell = Value
    end,
})

MainTab:CreateToggle({
    Name = "ğŸ’µ Auto Collect Money",
    CurrentValue = false,
    Flag = "AutoCollectMoney",
    Callback = function(Value)
        Settings.AutoCollectMoney = Value
    end,
})

MainTab:CreateToggle({
    Name = "âš¡ Instant Pickup",
    CurrentValue = true,
    Flag = "InstantPickup",
    Callback = function(Value)
        Settings.InstantPickup = Value
    end,
})

MainTab:CreateSlider({
    Name = "Farm Speed",
    Range = {10, 200},
    Increment = 10,
    CurrentValue = 100,
    Flag = "FarmSpeed",
    Callback = function(Value)
        Settings.FarmSpeed = Value
    end,
})

-- UPGRADE TAB
UpgradeTab:CreateLabel("â”â”â” âš¡ Auto Upgrades â”â”â”")

UpgradeTab:CreateToggle({
    Name = "âš¡ Auto Speed Upgrade",
    CurrentValue = false,
    Flag = "AutoSpeed",
    Callback = function(Value)
        Settings.AutoSpeedUpgrade = Value
    end,
})

UpgradeTab:CreateToggle({
    Name = "ğŸ“¦ Auto Carry Upgrade",
    CurrentValue = false,
    Flag = "AutoCarry",
    Callback = function(Value)
        Settings.AutoCarryUpgrade = Value
    end,
})

UpgradeTab:CreateToggle({
    Name = "ğŸ—ï¸ Auto Base Upgrade",
    CurrentValue = false,
    Flag = "AutoBase",
    Callback = function(Value)
        Settings.AutoBaseUpgrade = Value
    end,
})

UpgradeTab:CreateToggle({
    Name = "ğŸ’ Auto Brainrot Upgrade",
    CurrentValue = false,
    Flag = "AutoBrainrotUpgrade",
    Callback = function(Value)
        Settings.AutoBrainrotUpgrade = Value
    end,
})

UpgradeTab:CreateToggle({
    Name = "ğŸ”„ Auto Rebirth",
    CurrentValue = false,
    Flag = "AutoRebirth",
    Callback = function(Value)
        Settings.AutoRebirth = Value
    end,
})

UpgradeTab:CreateSlider({
    Name = "Rebirth at Speed",
    Range = {20, 500},
    Increment = 10,
    CurrentValue = 50,
    Flag = "RebirthSpeed",
    Callback = function(Value)
        Settings.RebirthAtSpeed = Value
    end,
})

UpgradeTab:CreateLabel("â”â”â” âš¡ Manual Upgrades â”â”â”")

UpgradeTab:CreateButton({
    Name = "âš¡ Buy Speed +1",
    Callback = function()
        BuySpeedUpgrade(1)
        Notify("Upgrade", "Bought +1 speed!", 2)
    end,
})

UpgradeTab:CreateButton({
    Name = "âš¡âš¡ Buy Speed +10",
    Callback = function()
        BuySpeedUpgrade(10)
        Notify("Upgrade", "Bought +10 speed!", 2)
    end,
})

UpgradeTab:CreateButton({
    Name = "ğŸ“¦ Buy Carry Upgrade",
    Callback = function()
        BuyCarryUpgrade()
        Notify("Upgrade", "Bought carry upgrade!", 2)
    end,
})

UpgradeTab:CreateButton({
    Name = "ğŸ”„ Rebirth Now",
    Callback = function()
        DoRebirth()
    end,
})

-- TELEPORT TAB
TeleportTab:CreateLabel("â”â”â” ğŸš€ Quick Teleports â”â”â”")

TeleportTab:CreateButton({
    Name = "ğŸ  Speed Shop (Safe Zone)",
    Callback = function()
        FindSpeedShop()
        TeleportTo(SpeedShopPosition)
        Notify("Teleport", "Teleported to safe zone!", 2)
    end,
})

TeleportTab:CreateButton({
    Name = "ğŸ  My Base",
    Callback = function()
        FindBase()
        TeleportTo(BasePosition)
        Notify("Teleport", "Teleported to base!", 2)
    end,
})

TeleportTab:CreateButton({
    Name = "ğŸ’ Nearest Brainrot",
    Callback = function()
        local brainrots = GetBrainrots()
        if #brainrots > 0 then
            TeleportTo(brainrots[1].Position)
            Notify("Teleport", "Teleported to brainrot!", 2)
        end
    end,
})

TeleportTab:CreateLabel("â”â”â” ğŸŒŠ Gap Navigation â”â”â”")

TeleportTab:CreateButton({
    Name = "â­ï¸ Next Gap",
    Callback = function()
        FindGaps()
        CurrentGap = math.min(CurrentGap + 1, #Gaps)
        if Gaps[CurrentGap] then
            TeleportTo(Gaps[CurrentGap].Position - Vector3.new(0, 5, 0))
            Notify("Teleport", "Gap " .. CurrentGap .. "/" .. #Gaps, 2)
        end
    end,
})

TeleportTab:CreateButton({
    Name = "â®ï¸ Previous Gap",
    Callback = function()
        FindGaps()
        CurrentGap = math.max(CurrentGap - 1, 1)
        if Gaps[CurrentGap] then
            TeleportTo(Gaps[CurrentGap].Position - Vector3.new(0, 5, 0))
            Notify("Teleport", "Gap " .. CurrentGap .. "/" .. #Gaps, 2)
        end
    end,
})

TeleportTab:CreateButton({
    Name = "ğŸ” Nearest Gap",
    Callback = function()
        local gap = FindNearestGap()
        if gap then
            TeleportTo(gap.Position - Vector3.new(0, 5, 0))
            Notify("Teleport", "Teleported to nearest gap!", 2)
        end
    end,
})

-- SAFETY TAB
SafetyTab:CreateLabel("â”â”â” ğŸ›¡ï¸ Protection â”â”â”")

SafetyTab:CreateToggle({
    Name = "âš ï¸ Auto Avoid Tsunami",
    CurrentValue = false,
    Flag = "AutoAvoid",
    Callback = function(Value)
        Settings.AutoAvoid = Value
    end,
})

SafetyTab:CreateToggle({
    Name = "ğŸ›¡ï¸ God Mode",
    CurrentValue = false,
    Flag = "GodMode",
    Callback = function(Value)
        Settings.GodMode = Value
    end,
})

SafetyTab:CreateToggle({
    Name = "ğŸƒ Custom Walk Speed",
    CurrentValue = false,
    Flag = "CustomWalkSpeed",
    Callback = function(Value)
        Settings.CustomWalkSpeed = Value
    end,
})

SafetyTab:CreateSlider({
    Name = "Walk Speed",
    Range = {16, 500},
    Increment = 1,
    CurrentValue = 50,
    Flag = "WalkSpeed",
    Callback = function(Value)
        Settings.WalkSpeedValue = Value
        if Settings.CustomWalkSpeed and Humanoid then
            Humanoid.WalkSpeed = Value
        end
    end,
})

SafetyTab:CreateLabel("â”â”â” ğŸŒŠ Tsunami Control â”â”â”")

SafetyTab:CreateButton({
    Name = "âŒ Delete Tsunami (May Be Patched)",
    Callback = function()
        DeleteTsunami()
        Notify("Tsunami", "Attempted to delete!", 2)
    end,
})

SafetyTab:CreateButton({
    Name = "ğŸšª Delete VIP Walls",
    Callback = function()
        DeleteVIPWalls()
        Notify("Walls", "Deleted VIP walls!", 2)
    end,
})

-- SETTINGS TAB
SettingsTab:CreateLabel("â”â”â” ğŸ¯ Collection Rarities â”â”â”")

for _, rarity in ipairs({"Celestial", "Secret", "Cosmic", "Legendary", "Mythical", "Epic", "Rare", "Uncommon", "Common"}) do
    SettingsTab:CreateToggle({
        Name = rarity,
        CurrentValue = Settings.TargetRarities[rarity],
        Flag = "Target" .. rarity,
        Callback = function(Value)
            Settings.TargetRarities[rarity] = Value
        end,
    })
end

SettingsTab:CreateLabel("â”â”â” ğŸ’° Selling Rarities â”â”â”")

for _, rarity in ipairs({"Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythical", "Cosmic", "Secret", "Celestial"}) do
    SettingsTab:CreateToggle({
        Name = "Sell " .. rarity,
        CurrentValue = Settings.SellRarities[rarity],
        Flag = "Sell" .. rarity,
        Callback = function(Value)
            Settings.SellRarities[rarity] = Value
        end,
    })
end

-- MISC TAB
MiscTab:CreateLabel("â”â”â” ğŸ”§ Utilities â”â”â”")

MiscTab:CreateToggle({
    Name = "ğŸ‘ï¸ ESP",
    CurrentValue = false,
    Flag = "ESP",
    Callback = function(Value)
        Settings.ESP = Value
        if not Value then
            ClearESP()
        end
    end,
})

MiscTab:CreateToggle({
    Name = "ğŸ’¤ Anti-AFK",
    CurrentValue = true,
    Flag = "AntiAFK",
    Callback = function(Value)
        Settings.AntiAFK = Value
    end,
})

MiscTab:CreateButton({
    Name = "ğŸ”„ Reset Character",
    Callback = function()
        if Humanoid then
            Humanoid.Health = 0
        end
    end,
})

MiscTab:CreateButton({
    Name = "ğŸ§¹ Clear ESP",
    Callback = function()
        ClearESP()
        Notify("ESP", "Cleared!", 2)
    end,
})

MiscTab:CreateButton({
    Name = "ğŸ’° Sell All Inventory",
    Callback = function()
        SellBrainrots()
        Notify("Sell", "Sold inventory!", 2)
    end,
})

-- Initialize
task.spawn(function()
    wait(2)
    FindSpeedShop()
    FindBase()
    FindGaps()
    
    Notify("Script Loaded!", "Escape Tsunami Ultimate is ready! ğŸŒŠ", 5)
    print("âœ… Script Loaded Successfully!")
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    print("ğŸŒŠ ALL FEATURES WORKING!")
    print("ğŸ® Use the menu to start farming!")
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
end)

-- Anti-AFK
Player.Idled:Connect(function()
    if Settings.AntiAFK then
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end
end)

-- Character respawn
Player.CharacterAdded:Connect(function(char)
    Character = char
    Humanoid = Character:WaitForChild("Humanoid")
    HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
    wait(2)
    FindSpeedShop()
    FindBase()
end)

-- Load config
Rayfield:LoadConfiguration()
